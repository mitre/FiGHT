================================================================================
FGT5019.003: Obtain subscriber identifier by NF
Architecture Segment:  Control-plane
----------------------------------------
Procedure Examples
----------------------------------------
Retrieve UE SUPI via API: The NEF stores the UE data – including SUPI-- in UDR and responds to API requests from various AFs. An adversary in control of an (external) AF uses legitimate SBA API to retrieve subscriber identifier of victim UE (SUPI) from their phone number. 

The API that the AF calls is Nnef_ApplyPolicy_Create API, it is sent to NEF with UE's GPSI/phone number. NEF retrieves the SUPI from UDM by using Nudm_SDM_Get API. See Section 4.15.6.8 of [1].

Alternatively, Rogue NEF retrieves SUPI from GPSI/phone number using Nudm_SDM_Get API towards the UDM, See section 4.13.2.2 of [1].
Retrieve UE’s sensitive information via rogue NF: The AMF can obtain some sensitive information about a UE it serves (or claims to serve). A rogue AMF in visited PLMN retrieves UE’s sensitive information from the home PLMN by calling an API when UE roams from 5GS to EPC.

AMF asks the SMF for UE Session Management context, and thus can obtain the following sensitive information: Permanent identifier (SUPI), the names of the slices the UE is subscribed to (S-NSSAIs), the name of the data network the UE is connected to, and the IP address of the UE. (The AMF API call to SMF is Nsmf_PDUSession_ContextRequest API, see Section 4.11.1.2.1 & Table 5.2.8.2.10-1 of [1])
----------------------------------------
Mitigations
----------------------------------------
FGM5019: NEF should check that UE in question is subscribed to services of the AF. This way, unauthorized access by external rogue AFs can be avoided.
----------------------------------------
Pre-Conditions
----------------------------------------
UE phone number and control of AF/NF: Adversary has knowledge of UE phone number/GPSI and has control over an AF or NEF or AMF.
----------------------------------------
Critical Assets
----------------------------------------
UE permanent identity (SUPI): If SUPI is stolen, many other subsequent attacks are possible such as subscriber identity spoofing and location tracking.
----------------------------------------
Detection
----------------------------------------
DS0015: Logging of AF inquiries for UEs that they don’t serve. Post process the logs to detect fraudulent API calls by rogue AF or NF.
----------------------------------------
Post-Conditions
----------------------------------------
SUPI is available to the adversary: If SUPI is obtained, many other subsequent attacks are possible such as subscriber identity spoofing and location tracking.
----------------------------------------
References
----------------------------------------
3rd Generation Partnership Project (3GPP) TS 23.502, “Procedures for the 5G System (5GS); Stage 2 (Release 17)”, v17.4.0, March 2022.: https://www.3gpp.org/DynaReport/23502.htm 
